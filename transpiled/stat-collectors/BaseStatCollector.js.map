{"version":3,"sources":["BaseStatCollector.js"],"names":[],"mappings":"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","file":"stat-collectors/BaseStatCollector.js","sourcesContent":["import execMethod from '../helpers/execMethod';\n\nexport default class BaseStatCollector {\n  constructor() {\n    this._collectors = [];\n    this._reset = true;\n    this._state = {};\n    this._ignore = [];\n  }\n  addCollector(collector) {\n    if (!this._reset) {\n      throw new Error('Cannot add a new collector unless you call reset() first');\n    }\n    if (typeof collector === 'object' && typeof collector.name === 'string') {\n      let reqIndex;\n      let requirements = collector.requirements;\n      if (!Array.isArray(requirements)) {\n        requirements = [];\n      }\n      this._collectors.forEach(function (currentCollector) {\n        if (currentCollector.name === collector.name) {\n          throw new Error('A collector with that name has already been added.');\n        }\n        reqIndex = requirements.indexOf(currentCollector.name);\n        if (reqIndex >= 0) {\n          requirements.splice(reqIndex, 1);\n        }\n      });\n      if (requirements.length) {\n        throw new Error(`Did not meet the requirements: ${requirements}`);\n      }\n      this._collectors.push(collector);\n    }\n    this.reset();\n  }\n  addIgnore(name) {\n    if (this._ignore.indexOf(name) === -1) {\n      this._ignore.push(name);\n    }\n  }\n  get() {\n    const self = this;\n    const result = {};\n    if (!this._reset) {\n      execMethod(this, 'onGet');\n    }\n    Object.keys(this._state).sort().forEach(function (key) {\n      if (self._ignore.indexOf(key) === -1) {\n        let val = self._state[key];\n        if (val) {\n          val = JSON.parse(JSON.stringify(val));\n        }\n        result[key] = val;\n      }\n    });\n    return result;\n  }\n  update(...values) {\n    const self = this;\n    values.forEach(function (value) {\n      if (Array.isArray(value)) {\n        value.forEach(function (v) {\n          self.update(v);\n        });\n      } else {\n        const v = parseFloat(value);\n        if (Number.isFinite(v)) {\n          execMethod(self, 'onUpdate', v);\n        }\n      }\n    });\n  }\n  reset() {\n    const self = this;\n    this._state = {};\n    this._collectors.forEach(function (collector) {\n      self._state[collector.name] = undefined;\n    });\n    this._reset = true;\n  }\n}\n"],"sourceRoot":"/source/"}